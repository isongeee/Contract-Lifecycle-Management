```sql
-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.approval_steps (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  contract_id uuid NOT NULL,
  approver_id uuid NOT NULL,
  status text NOT NULL,
  comment text,
  approved_at date,
  company_id uuid NOT NULL,
  app_id uuid NOT NULL,
  version_id uuid,
  CONSTRAINT approval_steps_pkey PRIMARY KEY (id),
  CONSTRAINT approval_steps_contract_id_fkey FOREIGN KEY (contract_id) REFERENCES public.contracts(id),
  CONSTRAINT approval_steps_approver_id_fkey FOREIGN KEY (approver_id) REFERENCES public.users(id),
  CONSTRAINT approval_steps_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(id),
  CONSTRAINT approval_steps_app_id_fkey FOREIGN KEY (app_id) REFERENCES public.apps(id),
  CONSTRAINT approval_steps_version_id_fkey FOREIGN KEY (version_id) REFERENCES public.contract_versions(id)
);
CREATE TABLE public.apps (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  name text NOT NULL,
  CONSTRAINT apps_pkey PRIMARY KEY (id)
);
CREATE TABLE public.audit_logs (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  user_id uuid,
  company_id uuid NOT NULL,
  app_id uuid NOT NULL,
  related_entity_type text NOT NULL,
  related_entity_id uuid NOT NULL,
  change_type text NOT NULL,
  old_value text,
  new_value text,
  CONSTRAINT audit_logs_pkey PRIMARY KEY (id),
  CONSTRAINT audit_logs_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id),
  CONSTRAINT audit_logs_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(id),
  CONSTRAINT audit_logs_app_id_fkey FOREIGN KEY (app_id) REFERENCES public.apps(id)
);
CREATE TABLE public.comments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  content text NOT NULL,
  author_id uuid NOT NULL,
  version_id uuid NOT NULL,
  resolved_at timestamp with time zone,
  company_id uuid NOT NULL,
  app_id uuid NOT NULL,
  anchor_text text,
  anchor_start integer,
  anchor_end integer,
  CONSTRAINT comments_pkey PRIMARY KEY (id),
  CONSTRAINT comments_author_id_fkey FOREIGN KEY (author_id) REFERENCES public.users(id),
  CONSTRAINT comments_version_id_fkey FOREIGN KEY (version_id) REFERENCES public.contract_versions(id),
  CONSTRAINT comments_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(id),
  CONSTRAINT comments_app_id_fkey FOREIGN KEY (app_id) REFERENCES public.apps(id)
);
CREATE TABLE public.companies (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  name text NOT NULL,
  slug text NOT NULL UNIQUE,
  app uuid NOT NULL,
  CONSTRAINT companies_pkey PRIMARY KEY (id),
  CONSTRAINT companies_app_fkey FOREIGN KEY (app) REFERENCES public.apps(id)
);
CREATE TABLE public.contract_property_allocations (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  contract_id uuid NOT NULL,
  property_id uuid,
  allocated_value numeric NOT NULL,
  monthly_values jsonb,
  manual_edits jsonb,
  company_id uuid NOT NULL,
  app_id uuid NOT NULL,
  CONSTRAINT contract_property_allocations_pkey PRIMARY KEY (id),
  CONSTRAINT contract_property_allocations_contract_id_fkey FOREIGN KEY (contract_id) REFERENCES public.contracts(id),
  CONSTRAINT contract_property_allocations_property_id_fkey FOREIGN KEY (property_id) REFERENCES public.properties(id),
  CONSTRAINT contract_property_allocations_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(id),
  CONSTRAINT contract_property_allocations_app_id_fkey FOREIGN KEY (app_id) REFERENCES public.apps(id)
);
CREATE TABLE public.contract_templates (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  name text NOT NULL,
  description text,
  type text NOT NULL,
  content text NOT NULL,
  company_id uuid NOT NULL,
  app_id uuid NOT NULL,
  CONSTRAINT contract_templates_pkey PRIMARY KEY (id),
  CONSTRAINT contract_templates_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(id),
  CONSTRAINT contract_templates_app_id_fkey FOREIGN KEY (app_id) REFERENCES public.apps(id)
);
CREATE TABLE public.contract_versions (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  contract_id uuid NOT NULL,
  version_number integer NOT NULL,
  author_id uuid,
  content text NOT NULL,
  file_name text,
  value numeric NOT NULL,
  effective_date date NOT NULL,
  end_date date NOT NULL,
  renewal_date date,
  frequency text NOT NULL,
  seasonal_months ARRAY,
  property_id uuid,
  company_id uuid NOT NULL,
  app_id uuid NOT NULL,
  status USER-DEFINED NOT NULL DEFAULT 'Draft'::contract_version_status,
  terms_snapshot jsonb,
  party_snapshot jsonb,
  property_snapshot jsonb,
  file_manifest jsonb,
  executed_at timestamp with time zone,
  storage_path text,
  fts tsvector DEFAULT to_tsvector('english'::regconfig, content),
  CONSTRAINT contract_versions_pkey PRIMARY KEY (id),
  CONSTRAINT contract_versions_contract_id_fkey FOREIGN KEY (contract_id) REFERENCES public.contracts(id),
  CONSTRAINT contract_versions_author_id_fkey FOREIGN KEY (author_id) REFERENCES public.users(id),
  CONSTRAINT contract_versions_property_id_fkey FOREIGN KEY (property_id) REFERENCES public.properties(id),
  CONSTRAINT contract_versions_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(id),
  CONSTRAINT contract_versions_app_id_fkey FOREIGN KEY (app_id) REFERENCES public.apps(id)
);
CREATE TABLE public.contracts (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  title text NOT NULL,
  type text NOT NULL,
  status USER-DEFINED NOT NULL,
  risk_level text NOT NULL,
  counterparty_id uuid NOT NULL,
  property_id uuid,
  owner_id uuid,
  effective_date date NOT NULL,
  end_date date NOT NULL,
  renewal_date date,
  value numeric NOT NULL,
  frequency text NOT NULL,
  seasonal_months ARRAY,
  allocation text NOT NULL,
  company_id uuid NOT NULL,
  app_id uuid NOT NULL,
  submitted_at timestamp with time zone,
  review_started_at timestamp with time zone,
  approval_started_at timestamp with time zone,
  approval_completed_at timestamp with time zone,
  sent_for_signature_at timestamp with time zone,
  executed_at timestamp with time zone,
  active_at timestamp with time zone,
  expired_at timestamp with time zone,
  archived_at timestamp with time zone,
  signature_provider text,
  signature_envelope_id text,
  signature_status text,
  executed_file_url text,
  executed_version_id uuid,
  updated_at timestamp with time zone DEFAULT now(),
  draft_version_id uuid,
  start_date date,
  auto_renew USER-DEFINED DEFAULT 'none'::auto_renew_type,
  notice_period_days integer,
  renewal_term_months integer,
  uplift_percent numeric,
  parent_contract_id uuid,
  signing_status USER-DEFINED,
  signing_status_updated_at timestamp with time zone,
  superseded_at timestamp with time zone,
  CONSTRAINT contracts_pkey PRIMARY KEY (id),
  CONSTRAINT contracts_counterparty_id_fkey FOREIGN KEY (counterparty_id) REFERENCES public.counterparties(id),
  CONSTRAINT contracts_property_id_fkey FOREIGN KEY (property_id) REFERENCES public.properties(id),
  CONSTRAINT contracts_owner_id_fkey FOREIGN KEY (owner_id) REFERENCES public.users(id),
  CONSTRAINT contracts_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(id),
  CONSTRAINT contracts_app_id_fkey FOREIGN KEY (app_id) REFERENCES public.apps(id),
  CONSTRAINT contracts_current_version_id_fkey FOREIGN KEY (executed_version_id) REFERENCES public.contract_versions(id),
  CONSTRAINT contracts_draft_version_id_fkey FOREIGN KEY (draft_version_id) REFERENCES public.contract_versions(id),
  CONSTRAINT contracts_parent_contract_id_fkey FOREIGN KEY (parent_contract_id) REFERENCES public.contracts(id)
);
CREATE TABLE public.counterparties (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  name text NOT NULL,
  type text NOT NULL,
  address_line1 text NOT NULL,
  address_line2 text,
  city text NOT NULL,
  state text NOT NULL,
  zip_code text NOT NULL,
  country text NOT NULL,
  contact_name text,
  contact_email text,
  contact_phone text,
  company_id uuid NOT NULL,
  app_id uuid NOT NULL,
  CONSTRAINT counterparties_pkey PRIMARY KEY (id),
  CONSTRAINT counterparties_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(id),
  CONSTRAINT counterparties_app_id_fkey FOREIGN KEY (app_id) REFERENCES public.apps(id)
);
CREATE TABLE public.notifications (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  user_id uuid NOT NULL,
  company_id uuid NOT NULL,
  app_id uuid NOT NULL,
  type text NOT NULL,
  message text NOT NULL,
  is_read boolean NOT NULL DEFAULT false,
  related_entity_type text,
  related_entity_id uuid,
  CONSTRAINT notifications_pkey PRIMARY KEY (id),
  CONSTRAINT notifications_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id),
  CONSTRAINT notifications_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(id),
  CONSTRAINT notifications_app_id_fkey FOREIGN KEY (app_id) REFERENCES public.apps(id)
);
CREATE TABLE public.properties (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  name text NOT NULL,
  address_line1 text NOT NULL,
  address_line2 text,
  city text NOT NULL,
  state text NOT NULL,
  country text NOT NULL,
  zip_code text NOT NULL,
  company_id uuid NOT NULL,
  app_id uuid NOT NULL,
  CONSTRAINT properties_pkey PRIMARY KEY (id),
  CONSTRAINT properties_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(id),
  CONSTRAINT properties_app_id_fkey FOREIGN KEY (app_id) REFERENCES public.apps(id)
);
CREATE TABLE public.renewal_feedback (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  renewal_request_id uuid NOT NULL,
  user_id uuid NOT NULL,
  feedback text NOT NULL CHECK (char_length(feedback) > 0),
  company_id uuid NOT NULL,
  app_id uuid NOT NULL,
  CONSTRAINT renewal_feedback_pkey PRIMARY KEY (id),
  CONSTRAINT renewal_feedback_app_id_fkey FOREIGN KEY (app_id) REFERENCES public.apps(id),
  CONSTRAINT renewal_feedback_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(id),
  CONSTRAINT renewal_feedback_renewal_request_id_fkey FOREIGN KEY (renewal_request_id) REFERENCES public.renewal_requests(id),
  CONSTRAINT renewal_feedback_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.renewal_requests (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  contract_id uuid NOT NULL UNIQUE,
  company_id uuid NOT NULL,
  app_id uuid NOT NULL,
  renewal_owner_id uuid,
  mode USER-DEFINED,
  status USER-DEFINED NOT NULL,
  notice_deadline date,
  internal_decision_deadline date,
  uplift_percent numeric,
  notes text,
  notice_period_days integer,
  renewal_term_months integer,
  path text,
  decision text,
  reason_code text,
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT renewal_requests_pkey PRIMARY KEY (id),
  CONSTRAINT renewal_requests_contract_id_fkey FOREIGN KEY (contract_id) REFERENCES public.contracts(id),
  CONSTRAINT renewal_requests_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(id),
  CONSTRAINT renewal_requests_app_id_fkey FOREIGN KEY (app_id) REFERENCES public.apps(id),
  CONSTRAINT renewal_requests_renewal_owner_id_fkey FOREIGN KEY (renewal_owner_id) REFERENCES public.users(id)
);
CREATE TABLE public.reports (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  name text NOT NULL,
  description text,
  owner_id uuid NOT NULL,
  company_id uuid NOT NULL,
  app_id uuid NOT NULL,
  configuration jsonb NOT NULL,
  is_prebuilt boolean NOT NULL DEFAULT false,
  CONSTRAINT reports_pkey PRIMARY KEY (id),
  CONSTRAINT reports_owner_id_fkey FOREIGN KEY (owner_id) REFERENCES public.users(id),
  CONSTRAINT reports_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(id),
  CONSTRAINT reports_app_id_fkey FOREIGN KEY (app_id) REFERENCES public.apps(id)
);
CREATE TABLE public.roles (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  name text NOT NULL,
  description text,
  permissions jsonb NOT NULL,
  company_id uuid NOT NULL,
  app_id uuid NOT NULL,
  CONSTRAINT roles_pkey PRIMARY KEY (id),
  CONSTRAINT roles_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(id),
  CONSTRAINT roles_app_id_fkey FOREIGN KEY (app_id) REFERENCES public.apps(id)
);
CREATE TABLE public.user_notification_settings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL UNIQUE,
  renewal_days_before ARRAY DEFAULT ARRAY[90, 60, 30, 14, 7, 1],
  preferences jsonb DEFAULT '{"tasks": {"email": false, "inApp": true}, "system": {"email": false, "inApp": true}, "renewals": {"email": true, "inApp": true}, "approvals": {"email": true, "inApp": true}}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT user_notification_settings_pkey PRIMARY KEY (id),
  CONSTRAINT user_notification_settings_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.users (
  id uuid NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  first_name text NOT NULL,
  last_name text NOT NULL,
  email text NOT NULL UNIQUE,
  phone text,
  job_title text,
  department text,
  avatar_url text,
  role_id uuid,
  status text NOT NULL DEFAULT 'active'::text,
  last_login date,
  company_id uuid NOT NULL,
  app_id uuid NOT NULL,
  CONSTRAINT users_pkey PRIMARY KEY (id),
  CONSTRAINT users_id_fkey FOREIGN KEY (id) REFERENCES auth.users(id),
  CONSTRAINT users_role_id_fkey FOREIGN KEY (role_id) REFERENCES public.roles(id),
  CONSTRAINT users_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(id),
  CONSTRAINT users_app_id_fkey FOREIGN KEY (app_id) REFERENCES public.apps(id)
);
```